<div class="diagram-container">
  @if (title()) {
  <h3 class="diagram-title">{{ title() }}</h3>
  }


  <!-- Component Tree Diagram -->
  @if (diagramType() === 'component-tree') {
  <div class="component-tree">
    <div class="tree-level">
      <div
        class="component-node root-node"
        [class.active]="currentStep() >= 1"
        [class.checking]="isAnimating() && currentStep() >= 1"
      >
        <div class="node-content">
          <span class="node-name">App Component</span>
          <span class="node-status">Always Checked</span>
        </div>
      </div>
    </div>

    <div class="connection-lines">
      <div class="line" [class.active]="currentStep() >= 2"></div>
      <div class="line" [class.active]="currentStep() >= 2"></div>
      <div class="line" [class.active]="currentStep() >= 2"></div>
    </div>

    <div class="tree-level">
      <div
        class="component-node"
        [class.active]="currentStep() >= 2"
        [class.checking]="isAnimating() && currentStep() >= 2"
      >
        <div class="node-content">
          <span class="node-name">Header</span>
          <span class="node-status">Checked Every Cycle</span>
        </div>
      </div>
      <div
        class="component-node"
        [class.active]="currentStep() >= 2"
        [class.checking]="isAnimating() && currentStep() >= 2"
      >
        <div class="node-content">
          <span class="node-name">Main Content</span>
          <span class="node-status">Checked Every Cycle</span>
        </div>
      </div>
      <div
        class="component-node"
        [class.active]="currentStep() >= 2"
        [class.checking]="isAnimating() && currentStep() >= 2"
      >
        <div class="node-content">
          <span class="node-name">Footer</span>
          <span class="node-status">Checked Every Cycle</span>
        </div>
      </div>
    </div>

    <div class="connection-lines">
      <div class="line" [class.active]="currentStep() >= 3"></div>
      <div class="line" [class.active]="currentStep() >= 3"></div>
    </div>

    <div class="tree-level">
      <div
        class="component-node"
        [class.active]="currentStep() >= 3"
        [class.checking]="isAnimating() && currentStep() >= 3"
      >
        <div class="node-content">
          <span class="node-name">User Card</span>
          <span class="node-status">Deep Child</span>
        </div>
      </div>
      <div
        class="component-node"
        [class.active]="currentStep() >= 3"
        [class.checking]="isAnimating() && currentStep() >= 3"
      >
        <div class="node-content">
          <span class="node-name">Product List</span>
          <span class="node-status">Deep Child</span>
        </div>
      </div>
    </div>
  </div>
  }

  <!-- OnPush Strategy Tree -->
  @if (diagramType() === 'onpush-tree') {
  <div class="component-tree onpush-tree">
    <div class="tree-level">
      <div class="component-node root-node" [class.active]="currentStep() >= 1" [class.checking]="isAnimating() && currentStep() >= 1">
        <div class="node-content">
          <span class="node-name">app-component</span>
          <span class="node-status">Default Strategy</span>
        </div>
      </div>
    </div>

    <div class="connection-lines">
      <div class="line" [class.active]="currentStep() >= 2"></div>
      <div class="line" [class.active]="currentStep() >= 2"></div>
    </div>

    <div class="tree-level">
      <div class="component-node" [class.active]="currentStep() >= 2" [class.checking]="isAnimating() && currentStep() >= 2">
        <div class="node-content">
          <span class="node-name">info-section</span>
          <span class="node-status">Default Strategy</span>
        </div>
      </div>
      <div class="component-node" [class.active]="currentStep() >= 2" [class.checking]="isAnimating() && currentStep() >= 2">
        <div class="node-content">
          <span class="node-name">user-section</span>
          <span class="node-status">Default Strategy</span>
        </div>
      </div>
    </div>

    <div class="connection-lines">
      <div class="line" [class.active]="currentStep() >= 3"></div>
      <div class="line" [class.active]="currentStep() >= 3"></div>
      <div class="line" [class.active]="currentStep() >= 3"></div>
      <div class="line" [class.active]="currentStep() >= 3"></div>
    </div>

    <div class="tree-level">
      <div class="component-node" [class.active]="currentStep() >= 3" [class.checking]="isAnimating() && currentStep() >= 3">
        <div class="node-content">
          <span class="node-name">info-sub-section1</span>
          <span class="node-status">Default Strategy</span>
        </div>
      </div>
      <div class="component-node onpush-node" [class.active]="currentStep() >= 3" [class.skipped]="isAnimating() && currentStep() >= 4">
        <div class="node-content">
          <span class="node-name">info-sub-section2 ⭐</span>
          <span class="node-status">OnPush - Skipped</span>
        </div>
      </div>
      <div class="component-node onpush-node" [class.active]="currentStep() >= 3" [class.checking]="isAnimating() && currentStep() >= 4">
        <div class="node-content">
          <span class="node-name">user-sub-section1 ⭐</span>
          <span class="node-status">OnPush - Input Changed</span>
        </div>
      </div>
      <div class="component-node onpush-node" [class.active]="currentStep() >= 3" [class.skipped]="isAnimating() && currentStep() >= 4">
        <div class="node-content">
          <span class="node-name">user-sub-section2 ⭐</span>
          <span class="node-status">OnPush - Skipped</span>
        </div>
      </div>
    </div>

    <div class="connection-lines">
      <div class="line" [class.active]="currentStep() >= 4"></div>
      <div class="line" [class.active]="currentStep() >= 4"></div>
      <div class="line" [class.active]="currentStep() >= 4"></div>
      <div class="line" [class.active]="currentStep() >= 4"></div>
    </div>

    <div class="tree-level">
      <div class="component-node" [class.active]="currentStep() >= 4" [class.checking]="isAnimating() && currentStep() >= 4">
        <div class="node-content">
          <span class="node-name">display-number</span>
          <span class="node-status">Default Strategy</span>
        </div>
      </div>
      <div class="component-node" [class.active]="currentStep() >= 4" [class.skipped]="isAnimating() && currentStep() >= 4">
        <div class="node-content">
          <span class="node-name">display-number</span>
          <span class="node-status">Skipped (OnPush Parent)</span>
        </div>
      </div>
      <div class="component-node" [class.active]="currentStep() >= 4" [class.checking]="isAnimating() && currentStep() >= 4">
        <div class="node-content">
          <span class="node-name">display-number</span>
          <span class="node-status">Checked (OnPush Parent)</span>
        </div>
      </div>
      <div class="component-node" [class.active]="currentStep() >= 4" [class.skipped]="isAnimating() && currentStep() >= 4">
        <div class="node-content">
          <span class="node-name">display-number</span>
          <span class="node-status">Skipped (OnPush Parent)</span>
        </div>
      </div>
    </div>

    <div class="legend-panel">
      <div class="legend-item">
        <div class="legend-box default"></div>
        <span>Default Strategy - Always Checked</span>
      </div>
      <div class="legend-item">
        <div class="legend-box onpush"></div>
        <span>⭐ OnPush Strategy - Checked Selectively</span>
      </div>
      <div class="legend-item">
        <div class="legend-box skipped"></div>
        <span>Skipped - No Input Changes</span>
      </div>
    </div>
  </div>
  }

  <!-- Traditional Component Tree (All Checked) -->
  @if (diagramType() === 'traditional-component-tree') {
  <div class="component-tree traditional-tree">
    <div class="tree-level">
      <div class="component-node root-node" [class.active]="currentStep() >= 1" [class.checking]="isAnimating() && currentStep() >= 1">
        <div class="node-content">
          <span class="node-name">app-component</span>
          <span class="node-status">Always Checked</span>
        </div>
      </div>
    </div>

    <div class="connection-lines">
      <div class="line" [class.active]="currentStep() >= 2"></div>
      <div class="line" [class.active]="currentStep() >= 2"></div>
    </div>

    <div class="tree-level">
      <div class="component-node" [class.active]="currentStep() >= 2" [class.checking]="isAnimating() && currentStep() >= 2">
        <div class="node-content">
          <span class="node-name">info-section</span>
          <span class="node-status">Always Checked</span>
        </div>
      </div>
      <div class="component-node" [class.active]="currentStep() >= 2" [class.checking]="isAnimating() && currentStep() >= 2">
        <div class="node-content">
          <span class="node-name">user-section</span>
          <span class="node-status">Always Checked</span>
        </div>
      </div>
    </div>

    <div class="connection-lines">
      <div class="line" [class.active]="currentStep() >= 3"></div>
      <div class="line" [class.active]="currentStep() >= 3"></div>
      <div class="line" [class.active]="currentStep() >= 3"></div>
      <div class="line" [class.active]="currentStep() >= 3"></div>
    </div>

    <div class="tree-level">
      <div class="component-node" [class.active]="currentStep() >= 3" [class.checking]="isAnimating() && currentStep() >= 3">
        <div class="node-content">
          <span class="node-name">info-sub-section1</span>
          <span class="node-status">Always Checked</span>
        </div>
      </div>
      <div class="component-node" [class.active]="currentStep() >= 3" [class.checking]="isAnimating() && currentStep() >= 3">
        <div class="node-content">
          <span class="node-name">info-sub-section2</span>
          <span class="node-status">Always Checked</span>
        </div>
      </div>
      <div class="component-node" [class.active]="currentStep() >= 3" [class.checking]="isAnimating() && currentStep() >= 3">
        <div class="node-content">
          <span class="node-name">user-sub-section1</span>
          <span class="node-status">Always Checked</span>
        </div>
      </div>
      <div class="component-node" [class.active]="currentStep() >= 3" [class.checking]="isAnimating() && currentStep() >= 3">
        <div class="node-content">
          <span class="node-name">user-sub-section2</span>
          <span class="node-status">Always Checked</span>
        </div>
      </div>
    </div>

    <div class="connection-lines">
      <div class="line" [class.active]="currentStep() >= 4"></div>
      <div class="line" [class.active]="currentStep() >= 4"></div>
      <div class="line" [class.active]="currentStep() >= 4"></div>
      <div class="line" [class.active]="currentStep() >= 4"></div>
    </div>

    <div class="tree-level">
      <div class="component-node" [class.active]="currentStep() >= 4" [class.checking]="isAnimating() && currentStep() >= 4">
        <div class="node-content">
          <span class="node-name">display-number</span>
          <span class="node-status">Always Checked</span>
        </div>
      </div>
      <div class="component-node" [class.active]="currentStep() >= 4" [class.checking]="isAnimating() && currentStep() >= 4">
        <div class="node-content">
          <span class="node-name">display-number</span>
          <span class="node-status">Always Checked</span>
        </div>
      </div>
      <div class="component-node" [class.active]="currentStep() >= 4" [class.checking]="isAnimating() && currentStep() >= 4">
        <div class="node-content">
          <span class="node-name">display-number</span>
          <span class="node-status">Always Checked</span>
        </div>
      </div>
      <div class="component-node" [class.active]="currentStep() >= 4" [class.checking]="isAnimating() && currentStep() >= 4">
        <div class="node-content">
          <span class="node-name">display-number</span>
          <span class="node-status">Always Checked</span>
        </div>
      </div>
    </div>
  </div>
  }

  <!-- OnPush Visual Summary (With Stars) -->
  @if (diagramType() === 'onpush-visual-summary') {
  <div class="component-tree onpush-summary">
    <div class="tree-level">
      <div class="component-node root-node" [class.active]="currentStep() >= 1">
        <div class="node-content">
          <span class="node-name">app-component</span>
          <span class="node-status">Default Strategy</span>
        </div>
      </div>
    </div>

    <div class="connection-lines">
      <div class="line" [class.active]="currentStep() >= 2"></div>
      <div class="line" [class.active]="currentStep() >= 2"></div>
    </div>

    <div class="tree-level">
      <div class="component-node" [class.active]="currentStep() >= 2">
        <div class="node-content">
          <span class="node-name">info-section</span>
          <span class="node-status">Default Strategy</span>
        </div>
      </div>
      <div class="component-node" [class.active]="currentStep() >= 2">
        <div class="node-content">
          <span class="node-name">user-section</span>
          <span class="node-status">Default Strategy</span>
        </div>
      </div>
    </div>

    <div class="connection-lines">
      <div class="line" [class.active]="currentStep() >= 3"></div>
      <div class="line" [class.active]="currentStep() >= 3"></div>
      <div class="line" [class.active]="currentStep() >= 3"></div>
      <div class="line" [class.active]="currentStep() >= 3"></div>
    </div>

    <div class="tree-level">
      <div class="component-node" [class.active]="currentStep() >= 3">
        <div class="node-content">
          <span class="node-name">info-sub-section1</span>
          <span class="node-status">Default Strategy</span>
        </div>
      </div>
      <div class="component-node onpush-node" [class.active]="currentStep() >= 3">
        <div class="node-content">
          <span class="node-name">info-sub-section2 ⭐</span>
          <span class="node-status">OnPush Strategy</span>
        </div>
      </div>
      <div class="component-node onpush-node" [class.active]="currentStep() >= 3">
        <div class="node-content">
          <span class="node-name">user-sub-section1 ⭐</span>
          <span class="node-status">OnPush Strategy</span>
        </div>
      </div>
      <div class="component-node onpush-node" [class.active]="currentStep() >= 3">
        <div class="node-content">
          <span class="node-name">user-sub-section2 ⭐</span>
          <span class="node-status">OnPush Strategy</span>
        </div>
      </div>
    </div>

    <div class="connection-lines">
      <div class="line" [class.active]="currentStep() >= 4"></div>
      <div class="line" [class.active]="currentStep() >= 4"></div>
      <div class="line" [class.active]="currentStep() >= 4"></div>
      <div class="line" [class.active]="currentStep() >= 4"></div>
    </div>

    <div class="tree-level">
      <div class="component-node" [class.active]="currentStep() >= 4">
        <div class="node-content">
          <span class="node-name">display-number</span>
          <span class="node-status">Default Strategy</span>
        </div>
      </div>
      <div class="component-node" [class.active]="currentStep() >= 4">
        <div class="node-content">
          <span class="node-name">display-number</span>
          <span class="node-status">Default Strategy</span>
        </div>
      </div>
      <div class="component-node" [class.active]="currentStep() >= 4">
        <div class="node-content">
          <span class="node-name">display-number</span>
          <span class="node-status">Default Strategy</span>
        </div>
      </div>
      <div class="component-node" [class.active]="currentStep() >= 4">
        <div class="node-content">
          <span class="node-name">display-number</span>
          <span class="node-status">Default Strategy</span>
        </div>
      </div>
    </div>

    <div class="legend-panel">
      <div class="legend-item">
        <div class="legend-box default"></div>
        <span>Default Strategy - Always Checked</span>
      </div>
      <div class="legend-item">
        <div class="legend-box onpush"></div>
        <span>⭐ OnPush Strategy - Checked Selectively</span>
      </div>
    </div>
  </div>
  }

  <!-- Zone.js Flow Diagram -->
  @if (diagramType() === 'zone-flow') {
  <div class="zone-flow">
    <div class="flow-step" [class.active]="currentStep() >= 1">
      <div class="step-icon">🖱️</div>
      <div class="step-content">
        <h4>User Event</h4>
        <p>Click, keyup, input, etc.</p>
      </div>
    </div>

    <div class="flow-arrow" [class.active]="currentStep() >= 2">→</div>

    <div class="flow-step" [class.active]="currentStep() >= 2">
      <div class="step-icon">⚡</div>
      <div class="step-content">
        <h4>Zone.js Intercepts</h4>
        <p>Patches browser APIs</p>
      </div>
    </div>

    <div class="flow-arrow" [class.active]="currentStep() >= 3">→</div>

    <div class="flow-step" [class.active]="currentStep() >= 3">
      <div class="step-icon">🔄</div>
      <div class="step-content">
        <h4>Change Detection</h4>
        <p>Checks entire component tree</p>
      </div>
    </div>

    <div class="flow-arrow" [class.active]="currentStep() >= 4">→</div>

    <div class="flow-step" [class.active]="currentStep() >= 4">
      <div class="step-icon">🎨</div>
      <div class="step-content">
        <h4>DOM Update</h4>
        <p>Updates UI elements</p>
      </div>
    </div>
  </div>
  }

  <!-- Signals Flow Diagram -->
  @if (diagramType() === 'signals-flow') {
  <div class="signals-flow">
    <div class="signal-step" [class.active]="currentStep() >= 1">
      <div class="signal-icon">📡</div>
      <div class="signal-content">
        <h4>Signal Update</h4>
        <p>signal.set() or signal.update()</p>
      </div>
    </div>

    <div class="flow-arrow" [class.active]="currentStep() >= 2">→</div>

    <div class="signal-step" [class.active]="currentStep() >= 2">
      <div class="signal-icon">🧮</div>
      <div class="signal-content">
        <h4>Computed Signals</h4>
        <p>Automatically recalculated</p>
      </div>
    </div>

    <div class="flow-arrow" [class.active]="currentStep() >= 3">→</div>

    <div class="signal-step" [class.active]="currentStep() >= 3">
      <div class="signal-icon">🎯</div>
      <div class="signal-content">
        <h4>Surgical Update</h4>
        <p>Only affected components</p>
      </div>
    </div>
  </div>
  }

  <!-- Performance Comparison Chart -->
  @if (diagramType() === 'performance-comparison') {
  <div class="performance-chart">
    <div class="chart-title">Change Detection Performance Comparison</div>
    <div class="chart-bars">
      @for (data of performanceData(); track data.name) {
      <div class="bar-container">
        <div
          class="bar"
          [style.height.%]="data.value"
          [style.background-color]="data.color"
          [style.animation-delay.ms]="$index * 300"
        ></div>
        <div class="bar-value">{{ data.time }}</div>
        <div class="bar-label">{{ data.name }}</div>
      </div>
      }
    </div>
    <div class="chart-note">
      <p>* Times are approximate and depend on application complexity</p>
    </div>
  </div>
  }

  <!-- Strategy Comparison -->
  @if (diagramType() === 'strategy-comparison') {
  <div class="strategy-comparison">
    <div class="strategy-card zone-card">
      <div class="strategy-header">
        <div class="strategy-icon">🌐</div>
        <h4>Zone.js</h4>
      </div>
      <div class="strategy-features">
        <div class="feature positive">✅ Automatic change detection</div>
        <div class="feature positive">✅ Works with any code pattern</div>
        <div class="feature negative">❌ Checks entire component tree</div>
        <div class="feature negative">❌ Can be inefficient</div>
        <div class="feature negative">❌ Harder to debug</div>
      </div>
    </div>

    <div class="vs-divider">VS</div>

    <div class="strategy-card signals-card">
      <div class="strategy-header">
        <div class="strategy-icon">📡</div>
        <h4>Signals</h4>
      </div>
      <div class="strategy-features">
        <div class="feature positive">✅ Fine-grained reactivity</div>
        <div class="feature positive">✅ Surgical updates</div>
        <div class="feature positive">✅ Clear dependency tracking</div>
        <div class="feature positive">✅ Better performance</div>
        <div class="feature positive">✅ Easier to debug</div>
      </div>
    </div>
  </div>
  }

  <!-- Async Problem Demo -->
  @if (diagramType() === 'async-problem-demo') {
  <div class="async-problem-demo">
    <div class="code-execution-timeline">
      <div class="timeline-step" [class.active]="currentStep() >= 1">
        <div class="step-number">1</div>
        <div class="step-content">
          <h4>User clicks button</h4>
          <code>changeName() called</code>
        </div>
      </div>

      <div class="timeline-step" [class.active]="currentStep() >= 2">
        <div class="step-number">2</div>
        <div class="step-content">
          <h4>setTimeout scheduled</h4>
          <code>setTimeout(() => name = 'Jane', 1000)</code>
        </div>
      </div>

      <div class="timeline-step" [class.active]="currentStep() >= 3">
        <div class="step-number">3</div>
        <div class="step-content">
          <h4>Angular runs change detection</h4>
          <code>angular.runChangeDetection()</code>
          <span class="problem">❌ Name hasn't changed yet!</span>
        </div>
      </div>

      <div class="timeline-step" [class.active]="currentStep() >= 4">
        <div class="step-number">4</div>
        <div class="step-content">
          <h4>1 second later...</h4>
          <code>name = 'Jane'</code>
          <span class="problem">❌ But Angular doesn't know!</span>
        </div>
      </div>
    </div>
  </div>
  }

  <!-- Dirty Marking Flow -->
  @if (diagramType() === 'dirty-marking-flow') {
  <div class="dirty-marking-flow">
    <div class="flow-container">
      <div class="trigger-events">
        <div class="event-card" [class.active]="currentStep() >= 1">
          <div class="event-icon">🖱️</div>
          <h4>Events</h4>
          <p>click, keyup, input</p>
        </div>
        <div class="event-card" [class.active]="currentStep() >= 1">
          <div class="event-icon">📥</div>
          <h4>Input Changes</h4>
          <p>@Input property changes</p>
        </div>
        <div class="event-card" [class.active]="currentStep() >= 1">
          <div class="event-icon">📤</div>
          <h4>Output Emissions</h4>
          <p>@Output event emissions</p>
        </div>
      </div>

      <div class="flow-arrow" [class.active]="currentStep() >= 2">↓</div>

      <div class="marking-process" [class.active]="currentStep() >= 2">
        <div class="process-box">
          <h4>markViewDirty()</h4>
          <p>Marks current component and all ancestors as dirty</p>
        </div>
      </div>

      <div class="flow-arrow" [class.active]="currentStep() >= 3">↓</div>

      <div class="component-tree-marking" [class.active]="currentStep() >= 3">
        <div class="tree-node dirty">App (Dirty)</div>
        <div class="tree-children">
          <div class="tree-node dirty">Parent (Dirty)</div>
          <div class="tree-node dirty">Child (Dirty) ← Changed</div>
        </div>
      </div>
    </div>
  </div>
  }

  <!-- Targeted Change Detection -->
  @if (diagramType() === 'targeted-change-detection') {
  <div class="targeted-cd">
    <div class="mode-explanation">
      <div class="mode-card global" [class.active]="currentStep() <= 2">
        <h4>GlobalMode</h4>
        <ul>
          <li>Check CheckAlways components</li>
          <li>Check Dirty OnPush components</li>
          <li>Top-down traversal</li>
        </ul>
      </div>

      <div class="mode-switch" [class.active]="currentStep() === 3">
        <span>Switch to TargetedMode when hitting Non-Dirty OnPush</span>
      </div>

      <div class="mode-card targeted" [class.active]="currentStep() >= 3">
        <h4>TargetedMode</h4>
        <ul>
          <li>Only refresh RefreshView components</li>
          <li>Skip CheckAlways without RefreshView</li>
          <li>Switch back to Global when RefreshView found</li>
        </ul>
      </div>
    </div>

    <div class="component-tree-targeted">
      <div class="tree-level">
        <div class="component-node" [class.active]="currentStep() >= 1">
          <span>Root (CheckAlways)</span>
          <span class="status">✅ Checked</span>
        </div>
      </div>

      <div class="tree-level">
        <div
          class="component-node onpush"
          [class.active]="currentStep() >= 2"
          [class.skipped]="currentStep() >= 3"
        >
          <span>OnPush + HAS_CHILD_VIEWS_TO_REFRESH</span>
          <span class="status">⏭️ Triggers TargetedMode</span>
        </div>
      </div>

      <div class="tree-level">
        <div
          class="component-node"
          [class.active]="currentStep() >= 4"
          [class.skipped]="currentStep() === 3"
        >
          <span>CheckAlways Child</span>
          <span class="status">⏭️ Skipped in TargetedMode</span>
        </div>
        <div class="component-node refresh-view" [class.active]="currentStep() >= 4">
          <span>RefreshView Component</span>
          <span class="status">🎯 Refreshed + Switch to Global</span>
        </div>
      </div>
    </div>
  </div>
  }

  <!-- Signal Dependency Graph -->
  @if (diagramType() === 'signal-dependency-graph') {
  <div class="signal-dependency-graph">
    <div class="signals-container">
      <div class="signal-node source" [class.active]="currentStep() >= 1">
        <div class="signal-icon">📡</div>
        <div class="signal-info">
          <h4>firstName</h4>
          <code>signal('John')</code>
        </div>
      </div>

      <div class="signal-node source" [class.active]="currentStep() >= 1">
        <div class="signal-icon">📡</div>
        <div class="signal-info">
          <h4>lastName</h4>
          <code>signal('Doe')</code>
        </div>
      </div>

      <div class="dependency-arrows" [class.active]="currentStep() >= 2">
        <div class="arrow">→</div>
        <div class="arrow">→</div>
      </div>

      <div class="signal-node computed" [class.active]="currentStep() >= 2">
        <div class="signal-icon">🧮</div>
        <div class="signal-info">
          <h4>fullName</h4>
          <code>computed(() => firstName() + ' ' + lastName())</code>
        </div>
      </div>

      <div class="dependency-arrows" [class.active]="currentStep() >= 3">
        <div class="arrow">→</div>
      </div>

      <div class="signal-node effect" [class.active]="currentStep() >= 3">
        <div class="signal-icon">⚡</div>
        <div class="signal-info">
          <h4>DOM Update</h4>
          <code>{{ 'fullName()' }}</code>
        </div>
      </div>
    </div>

    <div class="update-flow" [class.active]="currentStep() >= 4">
      <p>When firstName changes → fullName recalculates → DOM updates surgically</p>
    </div>
  </div>
  }

  <!-- Zoneless Architecture -->
  @if (diagramType() === 'zoneless-architecture') {
  <div class="zoneless-architecture">
    <div class="architecture-comparison">
      <div class="arch-column">
        <h4>With Zone.js</h4>
        <div class="arch-layer zone-layer">
          <div class="layer-box">Zone.js Monkey Patching</div>
          <div class="layer-box">Automatic Change Detection</div>
          <div class="layer-box">Full Tree Checking</div>
          <div class="layer-box">Angular Application</div>
        </div>
      </div>

      <div class="vs-divider">→</div>

      <div class="arch-column">
        <h4>Zoneless</h4>
        <div class="arch-layer zoneless-layer">
          <div class="layer-box">Explicit Triggers</div>
          <div class="layer-box">Smart Scheduling</div>
          <div class="layer-box">Targeted Updates</div>
          <div class="layer-box">Angular Application</div>
        </div>
      </div>
    </div>

    <div class="benefits-list" [class.active]="currentStep() >= 1">
      <div class="benefit">📦 -15KB bundle size</div>
      <div class="benefit">⚡ Faster startup</div>
      <div class="benefit">🧠 Lower memory usage</div>
      <div class="benefit">🎯 More predictable</div>
    </div>
  </div>
  }

  <!-- Signal APIs Flow -->
  @if (diagramType() === 'signal-apis-flow') {
  <div class="signal-apis-flow">
    <div class="api-showcase">
      <div class="api-card">
        <h4>linkedSignal()</h4>
        <div class="api-demo">
          <div class="signal-box">original</div>
          <div class="arrow">→</div>
          <div class="signal-box linked">workingCopy</div>
        </div>
        <p>Creates derived signals with dependencies</p>
      </div>

      <div class="api-card">
        <h4>resource()</h4>
        <div class="api-demo">
          <div class="resource-states">
            <div class="state loading">Loading</div>
            <div class="state success">Success</div>
            <div class="state error">Error</div>
          </div>
        </div>
        <p>Async data with built-in state management</p>
      </div>

      <div class="api-card">
        <h4>rxResource()</h4>
        <div class="api-demo">
          <div class="rxjs-integration">
            <div class="rx-box">RxJS</div>
            <div class="plus">+</div>
            <div class="signal-box">Signals</div>
          </div>
        </div>
        <p>RxJS integration with Signals</p>
      </div>
    </div>
  </div>
  }

  <!-- Migration Flow -->
  @if (diagramType() === 'migration-flow') {
  <div class="migration-flow">
    <div class="migration-steps">
      <div class="step">
        <div class="step-number">1</div>
        <div class="step-content">
          <h4>Update Angular</h4>
          <code>ng update @angular/core</code>
        </div>
      </div>

      <div class="arrow-down">↓</div>

      <div class="step">
        <div class="step-number">2</div>
        <div class="step-content">
          <h4>Run Migration</h4>
          <code>ng generate @angular/core:signals</code>
        </div>
      </div>

      <div class="arrow-down">↓</div>

      <div class="step">
        <div class="step-number">3</div>
        <div class="step-content">
          <h4>Enable Zoneless</h4>
          <code>provideZonelessChangeDetection()</code>
        </div>
      </div>

      <div class="arrow-down">↓</div>

      <div class="step final">
        <div class="step-number">✓</div>
        <div class="step-content">
          <h4>Zoneless Ready!</h4>
          <p>Faster, more efficient Angular app</p>
        </div>
      </div>
    </div>
  </div>
  }

  <!-- Future Roadmap -->
  @if (diagramType() === 'future-roadmap') {
  <div class="future-roadmap">
    <div class="roadmap-timeline">
      <div class="timeline-item current">
        <div class="year">2025</div>
        <div class="milestone">
          <h4>Angular 20-21</h4>
          <ul>
            <li>Zoneless Stable</li>
            <li>Signal Forms</li>
            <li>Selectorless Components</li>
          </ul>
        </div>
      </div>

      <div class="timeline-connector"></div>

      <div class="timeline-item future">
        <div class="year">2026</div>
        <div class="milestone">
          <h4>Angular 22-23</h4>
          <ul>
            <li>Signal-First Default</li>
            <li>Functional Components</li>
            <li>HTML-First Syntax</li>
          </ul>
        </div>
      </div>

      <div class="timeline-connector"></div>

      <div class="timeline-item vision">
        <div class="year">2027+</div>
        <div class="milestone">
          <h4>Angular 24+</h4>
          <ul>
            <li>Zone.js Deprecated</li>
            <li>AI-Assisted Development</li>
            <li>Full Wiz Integration</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  }

  <!-- AngularJS Overview -->
  @if (diagramType() === 'angularjs-overview') {
  <div class="angularjs-overview">
    <div class="angularjs-architecture">
      <div class="arch-layer">
        <h4>AngularJS Architecture (2010-2016)</h4>
        <div class="layer-stack">
          <div class="layer-box controller" [class.step-1]="currentStep() >= 1">
            <span class="layer-title">Controllers</span>
            <p>Business logic and scope management</p>
          </div>
          <div class="layer-box scope" [class.step-2]="currentStep() >= 2">
            <span class="layer-title">$scope & $rootScope</span>
            <p>Data binding and watcher registration</p>
          </div>
          <div class="layer-box digest" [class.step-3]="currentStep() >= 3">
            <span class="layer-title">Digest Cycle</span>
            <p>Change detection through dirty checking</p>
          </div>
          <div class="layer-box dom" [class.step-4]="currentStep() >= 4">
            <span class="layer-title">DOM Manipulation</span>
            <p>Automatic view updates</p>
          </div>
        </div>
      </div>

      <div class="features-grid">
        <div class="feature-card">
          <div class="feature-icon">🔄</div>
          <h5>Two-way Binding</h5>
          <p>Automatic sync between model and view</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">👁️</div>
          <h5>$watch Functions</h5>
          <p>Monitor scope variables for changes</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">🔍</div>
          <h5>Dirty Checking</h5>
          <p>Compare old vs new values</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">🌳</div>
          <h5>Scope Hierarchy</h5>
          <p>Nested scopes with inheritance</p>
        </div>
      </div>
    </div>
  </div>
  }

  <!-- AngularJS Performance -->
  @if (diagramType() === 'angularjs-performance') {
  <div class="angularjs-performance">
    <div class="performance-chart">
      <h4>AngularJS Performance vs Watcher Count</h4>
      <div class="chart-container">
        <div class="y-axis">
          <span>Performance</span>
          <div class="axis-labels">
            <span>Fast</span>
            <span>Medium</span>
            <span>Slow</span>
            <span>Unusable</span>
          </div>
        </div>
        <div class="chart-area">
          <div class="performance-line">
            <div class="point good" [class.step-1]="currentStep() >= 1" data-watchers="100">
              <div class="tooltip">100 watchers<br />Excellent performance</div>
            </div>
            <div class="point okay" [class.step-2]="currentStep() >= 2" data-watchers="500">
              <div class="tooltip">500 watchers<br />Good performance</div>
            </div>
            <div class="point warning" [class.step-3]="currentStep() >= 3" data-watchers="1000">
              <div class="tooltip">1000 watchers<br />Noticeable lag</div>
            </div>
            <div class="point bad" [class.step-4]="currentStep() >= 4" data-watchers="2000">
              <div class="tooltip">2000+ watchers<br />Performance problems</div>
            </div>
            <div class="point terrible" [class.step-5]="currentStep() >= 5" data-watchers="5000">
              <div class="tooltip">5000+ watchers<br />Unusable</div>
            </div>
          </div>
        </div>
        <div class="x-axis">
          <span>Number of Watchers</span>
          <div class="axis-labels">
            <span>0</span>
            <span>1K</span>
            <span>2K</span>
            <span>5K+</span>
          </div>
        </div>
      </div>
    </div>

    <div class="bottlenecks">
      <h4>Common Performance Bottlenecks</h4>
      <div class="bottleneck-list">
        <div class="bottleneck-item">
          <span class="severity high">🔴</span>
          <div class="bottleneck-content">
            <h5>Watcher Explosion</h5>
            <p>Each ng-repeat item × bindings = many watchers</p>
          </div>
        </div>
        <div class="bottleneck-item">
          <span class="severity high">🔴</span>
          <div class="bottleneck-content">
            <h5>Deep Watching</h5>
            <p>Watching large objects/arrays is expensive</p>
          </div>
        </div>
        <div class="bottleneck-item">
          <span class="severity medium">🟡</span>
          <div class="bottleneck-content">
            <h5>Complex Expressions</h5>
            <p>Functions in templates run every digest cycle</p>
          </div>
        </div>
        <div class="bottleneck-item">
          <span class="severity medium">🟡</span>
          <div class="bottleneck-content">
            <h5>Cascading Updates</h5>
            <p>Changes triggering more changes</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  }

  <!-- AngularJS to Angular Evolution -->
  @if (diagramType() === 'angularjs-to-angular-evolution') {
  <div class="angularjs-evolution">
    <div class="evolution-timeline">
      <div class="evolution-step legacy" [class.step-1]="currentStep() >= 1">
        <div class="step-year">2010-2016</div>
        <div class="step-content">
          <h4>AngularJS (1.x)</h4>
          <div class="tech-stack">
            <div class="tech-item digest">Digest Cycle</div>
            <div class="tech-item watchers">$watch Functions</div>
            <div class="tech-item dirty">Dirty Checking</div>
          </div>
          <div class="pros-cons">
            <div class="pros">
              <h5>✅ Pros</h5>
              <ul>
                <li>Revolutionary two-way binding</li>
                <li>Simple to understand</li>
                <li>Automatic change detection</li>
              </ul>
            </div>
            <div class="cons">
              <h5>❌ Cons</h5>
              <ul>
                <li>Performance degrades with scale</li>
                <li>Unpredictable digest cycles</li>
                <li>Memory leaks with watchers</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div class="evolution-arrow">→</div>

      <div class="evolution-step modern" [class.step-2]="currentStep() >= 2">
        <div class="step-year">2016-2024</div>
        <div class="step-content">
          <h4>Angular 2-19</h4>
          <div class="tech-stack">
            <div class="tech-item zone">Zone.js</div>
            <div class="tech-item onpush">OnPush Strategy</div>
            <div class="tech-item signals">Signals</div>
          </div>
          <div class="improvements">
            <h5>🚀 Improvements</h5>
            <ul>
              <li>Component tree optimization</li>
              <li>Predictable performance</li>
              <li>Fine-grained reactivity</li>
              <li>Better developer experience</li>
            </ul>
          </div>
        </div>
      </div>

      <div class="evolution-arrow">→</div>

      <div class="evolution-step future" [class.step-3]="currentStep() >= 3">
        <div class="step-year">2025+</div>
        <div class="step-content">
          <h4>Angular 20+</h4>
          <div class="tech-stack">
            <div class="tech-item zoneless">Zoneless</div>
            <div class="tech-item signal-forms">Signal Forms</div>
            <div class="tech-item ai">AI-Assisted</div>
          </div>
          <div class="vision">
            <h5>🔮 Vision</h5>
            <ul>
              <li>Zero-overhead reactivity</li>
              <li>Surgical DOM updates</li>
              <li>Perfect developer ergonomics</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <div class="evolution-metrics">
      <div class="metric">
        <h5>Performance</h5>
        <div class="metric-bar">
          <div class="bar angularjs" style="width: 30%">AngularJS</div>
          <div class="bar angular" style="width: 70%">Angular 2+</div>
          <div class="bar modern" style="width: 95%">Angular 20+</div>
        </div>
      </div>
      <div class="metric">
        <h5>Developer Experience</h5>
        <div class="metric-bar">
          <div class="bar angularjs" style="width: 60%">AngularJS</div>
          <div class="bar angular" style="width: 80%">Angular 2+</div>
          <div class="bar modern" style="width: 95%">Angular 20+</div>
        </div>
      </div>
      <div class="metric">
        <h5>Predictability</h5>
        <div class="metric-bar">
          <div class="bar angularjs" style="width: 40%">AngularJS</div>
          <div class="bar angular" style="width: 75%">Angular 2+</div>
          <div class="bar modern" style="width: 90%">Angular 20+</div>
        </div>
      </div>
    </div>
  </div>
  }

  <!-- NgZone Wrapper Diagram -->
  @if (diagramType() === 'ngzone-wrapper') {
  <div class="ngzone-wrapper">
    <div class="zone-container">
      <div class="ngzone-circle" [class.active]="currentStep() >= 1">
        <div class="zone-label">NgZone</div>

        <div class="root-component" [class.active]="currentStep() >= 2">
          <div class="component-icon">🏠</div>
          <span>Root</span>
        </div>

        <div class="zone-sections">
          <div class="outer-zone" [class.active]="currentStep() >= 3">
            <div class="zone-header">
              <span class="zone-name">Outer Zone</span>
              <span class="zone-subtitle">(Parent Zone)</span>
            </div>
            <div class="zone-info">
              <code>ngZone.runOutsideAngular()</code>
              <p>No automatic change detection</p>
            </div>
          </div>

          <div class="inner-zone" [class.active]="currentStep() >= 4">
            <div class="zone-header">
              <span class="zone-name">Inner Zone</span>
              <span class="zone-subtitle">(Angular Zone)</span>
            </div>
            <div class="zone-info">
              <code>ngZone.run()</code>
              <p>Automatic change detection</p>
            </div>
            <div class="component-tree">
              <div class="mini-component">Component 1</div>
              <div class="mini-component">Component 2</div>
              <div class="mini-component">Component 3</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="zone-usage-examples">
      <div class="example-card outer">
        <h5>Outer Zone Usage</h5>
        <ul>
          <li>Drag and drop operations</li>
          <li>Mouse move tracking</li>
          <li>Scroll events</li>
          <li>Animation frames</li>
        </ul>
      </div>
      <div class="example-card inner">
        <h5>Inner Zone Usage</h5>
        <ul>
          <li>Button clicks</li>
          <li>Form inputs</li>
          <li>HTTP requests</li>
          <li>Component logic</li>
        </ul>
      </div>
    </div>
  </div>
  }

  <!-- Immutability Patterns Diagram -->
  @if (diagramType() === 'immutability-patterns') {
  <div class="immutability-patterns">
    <div class="pattern-comparison">
      <div class="pattern-column bad" [class.active]="currentStep() >= 1">
        <div class="pattern-header">
          <span class="icon">❌</span>
          <h4>Mutation (Bad)</h4>
        </div>
        <div class="pattern-example">
          <div class="object-box">
            <span class="object-label">user</span>
            <div class="object-props">
              <div class="prop">name: "John"</div>
              <div class="prop">age: 30</div>
            </div>
            <div class="reference-id">Ref: 0x001</div>
          </div>
          <div class="mutation-arrow">⚠️ Mutate</div>
          <div class="object-box same-ref">
            <span class="object-label">user</span>
            <div class="object-props">
              <div class="prop changed">name: "Jane"</div>
              <div class="prop">age: 30</div>
            </div>
            <div class="reference-id">Ref: 0x001 (Same!)</div>
          </div>
          <div class="result-box fail">
            <span>OnPush won't detect change!</span>
          </div>
        </div>
      </div>

      <div class="vs-divider">VS</div>

      <div class="pattern-column good" [class.active]="currentStep() >= 2">
        <div class="pattern-header">
          <span class="icon">✅</span>
          <h4>Immutable Update (Good)</h4>
        </div>
        <div class="pattern-example">
          <div class="object-box">
            <span class="object-label">user</span>
            <div class="object-props">
              <div class="prop">name: "John"</div>
              <div class="prop">age: 30</div>
            </div>
            <div class="reference-id">Ref: 0x001</div>
          </div>
          <div class="immutable-arrow">✨ Create New</div>
          <div class="object-box new-ref">
            <span class="object-label">user</span>
            <div class="object-props">
              <div class="prop changed">name: "Jane"</div>
              <div class="prop">age: 30</div>
            </div>
            <div class="reference-id">Ref: 0x002 (New!)</div>
          </div>
          <div class="result-box success">
            <span>OnPush detects change! ✅</span>
          </div>
        </div>
      </div>
    </div>

    <div class="pattern-methods" [class.active]="currentStep() >= 3">
      <h4>Immutable Update Methods</h4>
      <div class="methods-grid">
        <div class="method-card">
          <code>{{ '{' }} ...obj, prop: newValue {{ '}' }}</code>
          <p>Spread operator for objects</p>
        </div>
        <div class="method-card">
          <code>[...arr, newItem]</code>
          <p>Spread operator for arrays</p>
        </div>
        <div class="method-card">
          <code>arr.map()</code>
          <p>Returns new array</p>
        </div>
        <div class="method-card">
          <code>arr.filter()</code>
          <p>Returns new array</p>
        </div>
      </div>
    </div>
  </div>
  }

  <!-- OnPush Triggers Diagram -->
  @if (diagramType() === 'onpush-triggers') {
  <div class="onpush-triggers">
    <div class="triggers-grid">
      <div class="trigger-card" [class.active]="currentStep() >= 1">
        <div class="trigger-icon">📥</div>
        <h4>Input Reference Change</h4>
        <div class="trigger-example">
          <code>&#64;Input() user: User;</code>
          <div class="change-indicator">
            <span class="old">Old ref: 0x001</span>
            <span class="arrow">→</span>
            <span class="new">New ref: 0x002</span>
          </div>
        </div>
        <p>Input property changes by reference</p>
      </div>

      <div class="trigger-card" [class.active]="currentStep() >= 2">
        <div class="trigger-icon">🖱️</div>
        <h4>Component Events</h4>
        <div class="trigger-example">
          <code>(click)="onClick()"</code>
          <div class="event-flow">
            <span>User Action</span>
            <span class="arrow">→</span>
            <span>Event Handler</span>
            <span class="arrow">→</span>
            <span>Change Detection</span>
          </div>
        </div>
        <p>Events emitted from component template</p>
      </div>

      <div class="trigger-card" [class.active]="currentStep() >= 3">
        <div class="trigger-icon">🔄</div>
        <h4>Async Pipe</h4>
        <div class="trigger-example">
          <code>{{ '{{ observable$ | async }}' }}</code>
          <div class="async-flow">
            <span>Observable Emits</span>
            <span class="arrow">→</span>
            <span>Async Pipe</span>
            <span class="arrow">→</span>
            <span>markForCheck()</span>
          </div>
        </div>
        <p>Async pipe receives new value</p>
      </div>

      <div class="trigger-card" [class.active]="currentStep() >= 4">
        <div class="trigger-icon">🔧</div>
        <h4>Manual Trigger</h4>
        <div class="trigger-example">
          <code>cdr.markForCheck()</code>
          <code>cdr.detectChanges()</code>
        </div>
        <p>Explicit change detection trigger</p>
      </div>
    </div>
  </div>
  }

  <!-- Async Pipe Flow Diagram -->
  @if (diagramType() === 'async-pipe-flow') {
  <div class="async-pipe-flow">
    <div class="flow-steps">
      <div class="step-card" [class.active]="currentStep() >= 1">
        <div class="step-number">1</div>
        <div class="step-content">
          <h4>Observable/Promise</h4>
          <code>users$ = http.get(url)</code>
          <p>Data source emits values</p>
        </div>
      </div>

      <div class="flow-arrow" [class.active]="currentStep() >= 2">↓</div>

      <div class="step-card" [class.active]="currentStep() >= 2">
        <div class="step-number">2</div>
        <div class="step-content">
          <h4>Async Pipe</h4>
          <code>{{ '{{ users$ | async }}' }}</code>
          <div class="pipe-actions">
            <div class="action">✅ Auto-subscribe</div>
            <div class="action">✅ Auto-unsubscribe</div>
            <div class="action">✅ Call markForCheck()</div>
          </div>
        </div>
      </div>

      <div class="flow-arrow" [class.active]="currentStep() >= 3">↓</div>

      <div class="step-card" [class.active]="currentStep() >= 3">
        <div class="step-number">3</div>
        <div class="step-content">
          <h4>Change Detection</h4>
          <p>Component updates automatically</p>
          <div class="cd-result">
            <span class="success">✅ OnPush Compatible</span>
            <span class="success">✅ No Memory Leaks</span>
          </div>
        </div>
      </div>
    </div>

    <div class="comparison-note">
      <h5>Why Async Pipe is Better</h5>
      <div class="benefits">
        <div class="benefit">📦 Less boilerplate code</div>
        <div class="benefit">🛡️ Automatic memory management</div>
        <div class="benefit">⚡ Works perfectly with OnPush</div>
        <div class="benefit">🎯 Declarative and clean</div>
      </div>
    </div>
  </div>
  }

  <!-- Manual CD Methods Diagram -->
  @if (diagramType() === 'manual-cd-methods') {
  <div class="manual-cd-methods">
    <div class="methods-grid">
      <div class="method-card" [class.active]="currentStep() >= 1">
        <div class="method-header">
          <div class="method-icon">⚡</div>
          <h4>detectChanges()</h4>
        </div>
        <div class="method-body">
          <code>this.cdr.detectChanges()</code>
          <div class="method-behavior">
            <p><strong>Behavior:</strong></p>
            <ul>
              <li>Runs change detection immediately</li>
              <li>Checks current component and children</li>
              <li>Synchronous operation</li>
            </ul>
          </div>
          <div class="use-case">
            <p><strong>Use when:</strong> Need immediate update</p>
          </div>
        </div>
      </div>

      <div class="method-card" [class.active]="currentStep() >= 2">
        <div class="method-header">
          <div class="method-icon">✓</div>
          <h4>markForCheck()</h4>
        </div>
        <div class="method-body">
          <code>this.cdr.markForCheck()</code>
          <div class="method-behavior">
            <p><strong>Behavior:</strong></p>
            <ul>
              <li>Marks component for next CD cycle</li>
              <li>Marks ancestors up to root</li>
              <li>Deferred until next cycle</li>
            </ul>
          </div>
          <div class="use-case">
            <p><strong>Use when:</strong> OnPush + async updates</p>
          </div>
        </div>
      </div>

      <div class="method-card" [class.active]="currentStep() >= 3">
        <div class="method-header">
          <div class="method-icon">🔌</div>
          <h4>detach()</h4>
        </div>
        <div class="method-body">
          <code>this.cdr.detach()</code>
          <div class="method-behavior">
            <p><strong>Behavior:</strong></p>
            <ul>
              <li>Removes from CD tree</li>
              <li>No automatic updates</li>
              <li>Manual control only</li>
            </ul>
          </div>
          <div class="use-case">
            <p><strong>Use when:</strong> Heavy computations</p>
          </div>
        </div>
      </div>

      <div class="method-card" [class.active]="currentStep() >= 4">
        <div class="method-header">
          <div class="method-icon">🔗</div>
          <h4>reattach()</h4>
        </div>
        <div class="method-body">
          <code>this.cdr.reattach()</code>
          <div class="method-behavior">
            <p><strong>Behavior:</strong></p>
            <ul>
              <li>Adds back to CD tree</li>
              <li>Resumes automatic updates</li>
              <li>Reverses detach()</li>
            </ul>
          </div>
          <div class="use-case">
            <p><strong>Use when:</strong> After detach() work done</p>
          </div>
        </div>
      </div>
    </div>

    <div class="workflow-example">
      <h5>Common Workflow</h5>
      <div class="workflow-steps">
        <code>cdr.detach()</code>
        <span>→</span>
        <code>// Heavy work</code>
        <span>→</span>
        <code>cdr.reattach()</code>
        <span>→</span>
        <code>cdr.detectChanges()</code>
      </div>
    </div>
  </div>
  }

  <!-- Angular Bootstrap Flow Diagram -->
  @if (diagramType() === 'angular-bootstrap-flow') {
  <div class="angular-bootstrap-flow">
    <div class="bootstrap-steps">
      <div class="step-row" [class.active]="currentStep() >= 1">
        <div class="step-number">1)</div>
        <div class="flow-boxes">
          <div class="flow-box">
            <span>browser.ts(File)</span>
          </div>
          <div class="flow-arrow">
            <span class="arrow-label">search</span>
            <span class="arrow">→</span>
          </div>
          <div class="flow-box">
            <span>bootstrapApplication() fn</span>
          </div>
          <div class="flow-arrow">
            <span class="arrow-label">Call</span>
            <span class="arrow">→</span>
          </div>
          <div class="flow-box highlight">
            <span>internalCreateApplication() fn</span>
            <div class="note">Exist in application_ref.ts(file)</div>
          </div>
        </div>
      </div>

      <div class="step-row" [class.active]="currentStep() >= 2">
        <div class="step-number">2)</div>
        <div class="flow-boxes">
          <div class="flow-box">
            <span>ApplicationRef.ts</span>
          </div>
          <div class="flow-arrow">
            <span class="arrow-label">Call</span>
            <span class="arrow">→</span>
          </div>
          <div class="flow-box success">
            <span>bootstrap() fn</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  }

  <!-- CD Tick Cycle Diagram -->
  @if (diagramType() === 'cd-tick-cycle') {
  <div class="cd-tick-cycle">
    <div class="cycle-layout">
      <div class="flow-diagram">
        <div class="step-box" [class.active]="currentStep() >= 1">
          <span class="step-label">3)</span>
          <span>CD will run</span>
        </div>

        <div class="branch-container" [class.active]="currentStep() >= 2">
          <div class="branch-label">Creation Mode</div>
          <div class="branch-label">Update Mode</div>

          <div class="branch-left">
            <div class="step-box small">
              <span>componentFactory.create()</span>
            </div>
            <div class="arrow-down">↓</div>
            <div class="arrow-label">Call</div>
          </div>

          <div class="branch-right">
            <div class="step-box small">
              <span>_loadComponent()</span>
            </div>
            <div class="arrow-down">↓</div>
            <div class="arrow-label">Call</div>
          </div>
        </div>

        <div class="merge-section" [class.active]="currentStep() >= 3">
          <div class="step-box">
            <span>renderView()</span>
          </div>
          <div class="arrow-down">↓</div>
          <div class="arrow-label">Call</div>
        </div>

        <div class="step-box highlight" [class.active]="currentStep() >= 4">
          <span>tick()</span>
          <div class="arrow-right">ex</div>
        </div>

        <div class="step-box" [class.active]="currentStep() >= 5">
          <span>detectChanges()</span>
          <div class="arrow-down">↓</div>
          <div class="arrow-label">Call</div>
        </div>

        <div class="step-box" [class.active]="currentStep() >= 6">
          <span>refreshView()</span>
          <div class="arrow-down">↓</div>
          <div class="arrow-label">Call</div>
        </div>

        <div class="step-box">
          <span>refreshChildComponents()</span>
          <div class="arrow-down">↓</div>
          <div class="arrow-label">Call</div>
        </div>

        <div class="dots">. . . . . . . .</div>
      </div>

      <div class="code-example">
        <div class="code-box">
          <pre><code>tick(): void {{ '{' }}
  try {{ '{' }}
    this._runningTick = true;
    for (let view of this._views) {{ '{' }}
      view.detectChanges();
    {{ '}' }}
  {{ '}' }}
  catch (e) {{ '{' }}...{{ '}' }}
  finally {{ '{' }}
    this._runningTick = false;
  {{ '}' }}
{{ '}' }}</code></pre>
        </div>
      </div>
    </div>
  </div>
  }

  <!-- Dirty Marking Tree Diagram -->
  @if (diagramType() === 'dirty-marking-tree') {
  <div class="dirty-marking-tree">
    <div class="tree-structure">
      <div class="tree-node root" [class.active]="currentStep() >= 1">
        <div class="node-icon">▶️</div>
        <span>Root</span>
        <div class="dirty-indicator" [class.show]="currentStep() >= 2">Dirty marking</div>
      </div>

      <div class="tree-branches">
        <div class="tree-level">
          <div class="tree-node" [class.active]="currentStep() >= 2">
            <div class="node-icon cyan">⏺️</div>
          </div>
          <div class="tree-node">
            <div class="node-icon">⏺️</div>
          </div>
          <div class="tree-node" [class.active]="currentStep() >= 2">
            <div class="node-icon">▶️</div>
          </div>
          <div class="tree-node">
            <div class="node-icon">⏺️</div>
          </div>
        </div>

        <div class="tree-level">
          <div class="tree-node">
            <div class="node-icon">⏺️</div>
          </div>
          <div class="tree-node">
            <div class="node-icon">⏺️</div>
          </div>
          <div class="tree-node">
            <div class="node-icon">⏺️</div>
          </div>
          <div class="tree-node">
            <div class="node-icon">⏺️</div>
          </div>
          <div class="tree-node" [class.active]="currentStep() >= 3">
            <div class="node-icon">▶️</div>
          </div>
          <div class="tree-node">
            <div class="node-icon">⏺️</div>
          </div>
        </div>
      </div>
    </div>

    <div class="legend" [class.active]="currentStep() >= 3">
      <div class="legend-item">
        <div class="legend-box default"></div>
        <span>Default Change detection</span>
      </div>
      <div class="legend-item">
        <div class="legend-box dirty"></div>
        <span>Dirty</span>
      </div>
    </div>
  </div>
  }

  <!-- Event Listener Wrapping Diagram -->
  @if (diagramType() === 'event-listener-wrapping') {
  <div class="event-listener-wrapping">
    <div class="wrap-flow">
      <div class="flow-step" [class.active]="currentStep() >= 1">
        <div class="step-box success">
          <span>Angular Will</span>
        </div>
        <div class="flow-arrow">
          <span class="arrow-label">Call</span>
          <span class="arrow">→</span>
        </div>
        <div class="step-box highlight">
          <span>wrapListenerIn_markDirtyAndPreventDefault()</span>
          <div class="icon cyan">⏺️</div>
        </div>
      </div>

      <div class="code-section" [class.active]="currentStep() >= 2">
        <div class="code-box">
          <pre><code>element.addEventListener('click',
  wrapListenerIn_markDirtyAndPreventDefault(<span class="highlight">ChangeName</span>));</code></pre>
        </div>
      </div>

      <div class="function-detail" [class.active]="currentStep() >= 3">
        <div class="code-box large">
          <pre><code>function wrapListener(): EventListener {{ '{' }}
  return function wrapListenerIn_markDirtyAndPreventDefault(e: any) {{ '{' }}
    // ... code removed for brevity
    <span class="highlight">markViewDirty(startView)</span>; // mark the component as dirty ▶️
  {{ '}' }};
{{ '}' }}</code></pre>
        </div>
      </div>
    </div>
  </div>
  }

  <!-- OnPush Visual Summary with Stars -->
  @if (diagramType() === 'onpush-visual-summary') {
  <div class="onpush-visual-summary">
    <div class="component-tree onpush-visual-tree">
      <div class="tree-level">
        <div class="component-node root-node" [class.active]="currentStep() >= 1">
          <div class="node-content">
            <span class="node-name">app-component</span>
          </div>
        </div>
      </div>

      <div class="connection-lines">
        <div class="line" [class.active]="currentStep() >= 2"></div>
        <div class="line" [class.active]="currentStep() >= 2"></div>
      </div>

      <div class="tree-level">
        <div class="component-node" [class.active]="currentStep() >= 2">
          <div class="node-content">
            <span class="node-name">info-section</span>
          </div>
        </div>
        <div class="component-node" [class.active]="currentStep() >= 2">
          <div class="node-content">
            <span class="node-name">user-section</span>
          </div>
        </div>
      </div>

      <div class="connection-lines">
        <div class="line" [class.active]="currentStep() >= 3"></div>
        <div class="line" [class.active]="currentStep() >= 3"></div>
        <div class="line" [class.active]="currentStep() >= 3"></div>
        <div class="line" [class.active]="currentStep() >= 3"></div>
      </div>

      <div class="tree-level">
        <div class="component-node" [class.active]="currentStep() >= 3">
          <div class="node-content">
            <span class="node-name">info-sub-section1</span>
          </div>
        </div>
        <div class="component-node onpush-star" [class.active]="currentStep() >= 3">
          <div class="node-content">
            <span class="node-name">info-sub-section2</span>
            <span class="star">⭐</span>
          </div>
        </div>
        <div class="component-node onpush-star" [class.active]="currentStep() >= 3">
          <div class="node-content">
            <span class="node-name">user-sub-section1</span>
            <span class="star">⭐</span>
          </div>
        </div>
        <div class="component-node onpush-star" [class.active]="currentStep() >= 3">
          <div class="node-content">
            <span class="node-name">user-sub-section2</span>
            <span class="star">⭐</span>
          </div>
        </div>
      </div>

      <div class="connection-lines">
        <div class="line" [class.active]="currentStep() >= 4"></div>
      </div>

      <div class="tree-level">
        <div class="component-node small-node" [class.active]="currentStep() >= 4">
          <div class="node-content">
            <span class="node-name">display-number</span>
          </div>
        </div>
        <div class="component-node small-node" [class.active]="currentStep() >= 4">
          <div class="node-content">
            <span class="node-name">display-number</span>
          </div>
        </div>
        <div class="component-node small-node highlighted-node" [class.active]="currentStep() >= 4">
          <div class="node-content">
            <span class="node-name">display-number</span>
          </div>
        </div>
        <div class="component-node small-node" [class.active]="currentStep() >= 4">
          <div class="node-content">
            <span class="node-name">display-number</span>
          </div>
        </div>
      </div>
    </div>

    <div class="visual-legend" [class.active]="currentStep() >= 4">
      <div class="legend-item">
        <span class="legend-star">⭐</span>
        <span>Component with OnPush</span>
      </div>
      <div class="legend-item">
        <div class="legend-box highlighted"></div>
        <span>Updated due to OnPush trigger</span>
      </div>
    </div>
  </div>
  }

  <!-- Traditional Component Tree Diagram -->
  @if (diagramType() === 'traditional-component-tree') {
  <div class="traditional-component-tree">
    <div class="component-tree traditional-tree">
      <div class="tree-level">
        <div
          class="component-node root-node"
          [class.active]="currentStep() >= 1"
          [class.checking]="isAnimating() && currentStep() >= 1"
        >
          <div class="node-content">
            <span class="node-name">app-component</span>
            <span class="node-status">Root</span>
          </div>
        </div>
      </div>

      <div class="connection-lines">
        <div class="line" [class.active]="currentStep() >= 2"></div>
        <div class="line" [class.active]="currentStep() >= 2"></div>
        <div class="line" [class.active]="currentStep() >= 2"></div>
      </div>

      <div class="tree-level">
        <div
          class="component-node"
          [class.active]="currentStep() >= 2"
          [class.checking]="isAnimating() && currentStep() >= 2"
        >
          <div class="node-content">
            <span class="node-name">Header</span>
            <span class="node-status">Always Checked</span>
          </div>
        </div>
        <div
          class="component-node"
          [class.active]="currentStep() >= 2"
          [class.checking]="isAnimating() && currentStep() >= 2"
        >
          <div class="node-content">
            <span class="node-name">Main Content</span>
            <span class="node-status">Always Checked</span>
          </div>
        </div>
        <div
          class="component-node"
          [class.active]="currentStep() >= 2"
          [class.checking]="isAnimating() && currentStep() >= 2"
        >
          <div class="node-content">
            <span class="node-name">Footer</span>
            <span class="node-status">Always Checked</span>
          </div>
        </div>
      </div>

      <div class="connection-lines">
        <div class="line" [class.active]="currentStep() >= 3"></div>
        <div class="line" [class.active]="currentStep() >= 3"></div>
      </div>

      <div class="tree-level">
        <div
          class="component-node"
          [class.active]="currentStep() >= 3"
          [class.checking]="isAnimating() && currentStep() >= 3"
        >
          <div class="node-content">
            <span class="node-name">User Card</span>
            <span class="node-status">Always Checked</span>
          </div>
        </div>
        <div
          class="component-node"
          [class.active]="currentStep() >= 3"
          [class.checking]="isAnimating() && currentStep() >= 3"
        >
          <div class="node-content">
            <span class="node-name">Product List</span>
            <span class="node-status">Always Checked</span>
          </div>
        </div>
      </div>

      <div class="info-box" [class.active]="currentStep() >= 4">
        <p>
          ⚠️ In default strategy, Angular checks EVERY component on every change detection cycle,
          even if only one component changed.
        </p>
      </div>
    </div>
  </div>
  }

  <!-- NgZone Component Tree Diagram -->
  @if (diagramType() === 'ngzone-component-tree') {
  <div class="ngzone-component-tree">
    <div class="ngzone-circle-wrapper" [class.active]="currentStep() >= 1">
      <div class="ngzone-label">NgZone</div>

      <div class="tree-structure-inside">
        <div class="tree-node root" [class.active]="currentStep() >= 2">
          <span>Root</span>
        </div>

        <div class="tree-level-1">
          <div class="tree-node onpush-dirty" [class.active]="currentStep() >= 3">
            <div class="shield-icon">🛡️</div>
          </div>
          <div class="tree-node default">
            <div class="shield-icon">🛡️</div>
          </div>
          <div class="tree-node onpush-dirty">
            <div class="shield-icon">🛡️</div>
          </div>
          <div class="tree-node default">
            <div class="shield-icon">🛡️</div>
          </div>
        </div>

        <div class="tree-level-2">
          <div class="tree-node default"></div>
          <div class="tree-node default"></div>
          <div class="tree-node default"></div>
          <div class="tree-node default"></div>
          <div class="tree-node default"></div>
          <div class="tree-node refreshed" [class.active]="currentStep() >= 4">
            <div class="cursor-icon">🖱️</div>
          </div>
        </div>
      </div>
    </div>

    <div class="legend-panel">
      <div class="legend-item">
        <div class="legend-box default"></div>
        <span>Default Change detection</span>
      </div>
      <div class="legend-item">
        <div class="legend-box dirty"></div>
        <span>Dirty</span>
      </div>
      <div class="legend-item">
        <div class="legend-box onpush"></div>
        <span>OnPush Change detection</span>
      </div>
      <div class="legend-item">
        <div class="legend-box onpush-dirty"></div>
        <span>OnPush + Dirty</span>
      </div>
      <div class="legend-item">
        <div class="legend-box refreshed"></div>
        <span>Bindings refreshed</span>
      </div>
    </div>
  </div>
  }

</div>
